import{_ as c,c as o,o as h,b as l,f as u,i as d,t as g,j as m}from"./app--Vh3dkqs.js";const w={props:{imageUrl:{type:String,required:!0}},data(){return{isOpen:!1,scale:1,minScale:.5,maxScale:5,translateX:0,translateY:0,startX:0,startY:0,isDragging:!1,savedScroll:0,touchStart:{touches:0,distance:0,centerX:0,centerY:0,time:0}}},methods:{openViewer(){this.savedScroll=window.scrollY,this.resetView(),this.isOpen=!0,document.body.style.overflow="hidden",document.body.style.touchAction="none"},closeViewer(){this.isDragging||(this.isOpen=!1,document.body.style.overflow="",document.body.style.touchAction="",window.scrollTo(0,this.savedScroll))},zoomIn(){this.scale=Math.min(this.scale+.1,this.maxScale)},zoomOut(){this.scale=Math.max(this.scale-.1,this.minScale)},resetView(){this.scale=1,this.translateX=0,this.translateY=0},handleDoubleClick(){this.scale=Math.min(1.5,this.maxScale)},startDrag(i){this.isDragging=!0,this.startX=i.clientX-this.translateX,this.startY=i.clientY-this.translateY},handleDrag(i){this.isDragging&&(this.translateX=i.clientX-this.startX,this.translateY=i.clientY-this.startY)},stopDrag(){this.isDragging=!1},handleWheel(i){i.preventDefault();const t=i.deltaY<0?.1:-.1;this.scale=Math.max(this.minScale,Math.min(this.scale+t,this.maxScale))},handleTouchStart(i){const t=i.touches;if(this.touchStart.time=Date.now(),t.length===1)this.isDragging=!0,this.startX=t[0].clientX-this.translateX,this.startY=t[0].clientY-this.translateY;else if(t.length===2){this.isDragging=!1,this.touchStart.touches=2,this.touchStart.distance=this.getTouchDistance(t);const n=this.getTouchCenter(t);this.touchStart.centerX=n.x,this.touchStart.centerY=n.y}},handleTouchMove(i){i.preventDefault();const t=i.touches;if(t.length===1&&this.isDragging)this.translateX=t[0].clientX-this.startX,this.translateY=t[0].clientY-this.startY;else if(t.length===2){const n=this.getTouchDistance(t),r=n/this.touchStart.distance,a=Math.max(this.minScale,Math.min(this.scale*r,this.maxScale)),e=this.getTouchCenter(t);this.translateX=e.x-(e.x-this.translateX)*(a/this.scale),this.translateY=e.y-(e.y-this.translateY)*(a/this.scale),this.scale=a,this.touchStart.distance=n}},handleTouchEnd(i){this.isDragging=!1,this.touchStart.touches=0,Date.now()-this.touchStart.time<300&&(this.scale=Math.min(1.5,this.maxScale))},getTouchDistance(i){const t=i[0].clientX-i[1].clientX,n=i[0].clientY-i[1].clientY;return Math.sqrt(t*t+n*n)},getTouchCenter(i){return{x:(i[0].clientX+i[1].clientX)/2,y:(i[0].clientY+i[1].clientY)/2}}},mounted(){document.addEventListener("keydown",i=>{i.key==="Escape"&&this.isOpen&&this.closeViewer()})},beforeUnmount(){document.removeEventListener("keydown",i=>{i.key==="Escape"&&this.isOpen&&this.closeViewer()})}},D=["src"],f={class:"image-container"},S=["src"],v={class:"viewer-toolbar"},Y={class:"zoom-info"};function X(i,t,n,r,a,e){return h(),o("div",null,[l("img",{src:n.imageUrl,alt:"可预览图片",onClick:t[0]||(t[0]=(...s)=>e.openViewer&&e.openViewer(...s)),class:"thumbnail"},null,8,D),a.isOpen?(h(),o("div",{key:0,class:"viewer-container",onClick:t[13]||(t[13]=(...s)=>e.closeViewer&&e.closeViewer(...s)),onTouchstart:t[14]||(t[14]=(...s)=>e.handleTouchStart&&e.handleTouchStart(...s)),onTouchmove:t[15]||(t[15]=(...s)=>e.handleTouchMove&&e.handleTouchMove(...s)),onTouchend:t[16]||(t[16]=(...s)=>e.handleTouchEnd&&e.handleTouchEnd(...s))},[l("div",{class:"viewer-content",onClick:t[12]||(t[12]=m(()=>{},["stop"]))},[l("div",f,[l("img",{src:n.imageUrl,alt:"预览图片",class:"viewer-image",style:d({transform:`translate(${a.translateX}px, ${a.translateY}px) scale(${a.scale})`,transition:a.isDragging?"none":"transform 0.2s ease"}),onClick:t[1]||(t[1]=(...s)=>e.closeViewer&&e.closeViewer(...s)),onDblclick:t[2]||(t[2]=(...s)=>e.handleDoubleClick&&e.handleDoubleClick(...s)),onMousedown:t[3]||(t[3]=(...s)=>e.startDrag&&e.startDrag(...s)),onMousemove:t[4]||(t[4]=(...s)=>e.handleDrag&&e.handleDrag(...s)),onMouseup:t[5]||(t[5]=(...s)=>e.stopDrag&&e.stopDrag(...s)),onMouseleave:t[6]||(t[6]=(...s)=>e.stopDrag&&e.stopDrag(...s)),onWheel:t[7]||(t[7]=(...s)=>e.handleWheel&&e.handleWheel(...s))},null,44,S)]),l("div",v,[l("button",{onClick:t[8]||(t[8]=(...s)=>e.zoomOut&&e.zoomOut(...s)),class:"tool-btn"},"-"),l("span",Y,g(Math.round(a.scale*100))+"%",1),l("button",{onClick:t[9]||(t[9]=(...s)=>e.zoomIn&&e.zoomIn(...s)),class:"tool-btn"},"+"),l("button",{onClick:t[10]||(t[10]=(...s)=>e.resetView&&e.resetView(...s)),class:"tool-btn"},"重置"),l("button",{onClick:t[11]||(t[11]=(...s)=>e.closeViewer&&e.closeViewer(...s)),class:"tool-btn close-btn"},"×")])])],32)):u("",!0)])}const y=c(w,[["render",X],["__scopeId","data-v-a0262b9d"]]);export{y as default};
